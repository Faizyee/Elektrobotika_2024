<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8"> <!-- Menentukan karakter set untuk dokumen -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Mengatur viewport untuk responsivitas -->
    <title>Elektrobotika 2024</title> <!-- Judul halaman yang akan ditampilkan di tab browser -->
    <style>
        * {
            outline: none; /* Menghilangkan outline default */
            -webkit-appearance: none; /* Menghilangkan tampilan default pada elemen form di WebKit */
            appearance: none; /* Menghilangkan tampilan default pada elemen form */
            -webkit-box-shadow: none; /* Menghilangkan bayangan default pada WebKit */
            box-shadow: none; /* Menghilangkan bayangan default */
            user-select: none; /* Mencegah pengguna memilih teks */
        }

        body {
            font-family: Arial, sans-serif; /* Mengatur font untuk seluruh halaman */
            display: flex; /* Menggunakan flexbox untuk layout */
            flex-direction: column; /* Mengatur arah flex menjadi kolom */
            align-items: center; /* Mengatur item agar terpusat secara horizontal */
            justify-content: center; /* Mengatur item agar terpusat secara vertikal */
            min-height: 100vh; /* Minimum tinggi body 100% dari viewport */
            margin: 0; /* Menghilangkan margin default */
            background-color: #f4f4f9; /* Mengatur warna latar belakang */
        }

        .start-container {
            display: flex; /* Menggunakan flexbox untuk container awal */
            flex-direction: column; /* Mengatur arah flex menjadi kolom */
            align-items: center; /* Mengatur item agar terpusat secara horizontal */
            justify-content: space-between; /* Memberikan ruang antar item */
            width: 100%; /* Lebar penuh */
            max-width: 600px; /* Lebar maksimum 600px */
            padding: 20px; /* Memberikan padding */
            box-sizing: border-box; /* Menghitung padding dan border dalam lebar dan tinggi */
            gap: 10px; /* Jarak antar item */
        }

        .main-container {
            display: flex; /* Menggunakan flexbox untuk container utama */
            flex-direction: row; /* Mengatur arah flex menjadi baris */
            align-items: center; /* Mengatur item agar terpusat secara vertikal */
            justify-content: space-between; /* Memberikan ruang antar item */
            width: 100%; /* Lebar penuh */
            max-width: 600px; /* Lebar maksimum 600px */
            padding: 20px; /* Memberikan padding */
            box-sizing: border-box; /* Menghitung padding dan border dalam lebar dan tinggi */
        }

        .column {
            display: flex; /* Menggunakan flexbox untuk kolom */
            flex-direction: column; /* Mengatur arah flex menjadi kolom */
            align-items: center; /* Mengatur item agar terpusat secara horizontal */
            gap: 10px; /* Jarak antar item */
        }

        .button {
            width: 100px; /* Lebar tombol */
            height: 100px; /* Tinggi tombol */
            font-size: 16px; /* Ukuran font untuk teks tombol */
            cursor: pointer; /* Mengubah kursor saat hover */
            background-color: #007bff; /* Warna latar belakang tombol */
            color: white; /* Warna teks tombol */
            border: none; /* Menghilangkan border default */
            border-radius: 5px; /* Membuat sudut tombol melengkung */
            text-align: center; /* Mengatur teks agar terpusat */
        }

        .button.active {
            background-color: #0056b3; /* Warna tombol saat ditekan */
        }

        .seekbar-container {
            display: flex; /* Menggunakan flexbox untuk container seekbar */
            flex-direction: column; /* Mengatur arah flex menjadi kolom */
            align-items: center; /* Mengatur item agar terpusat secara horizontal */
            gap: 10px; /* Jarak antar item */
        }

        .seekbar {
            writing-mode: bt-lr; /* Mengatur orientasi seekbar secara vertikal */
            -webkit-appearance: slider-vertical; /* Mengatur tampilan seekbar di WebKit */
            height: 180px; /* Tinggi seekbar */
            width: 20px; /* Lebar seekbar */
        }

        #seekbar-value {
            font-size: 16px; /* Ukuran font untuk nilai seekbar */
            font-weight: bold; /* Membuat font menjadi tebal */
        }

        .hidden {
            display: none; /* Menghilangkan elemen yang memiliki kelas ini */
        }

        #btn-start {
            width: 100px; /* Lebar tombol mulai */
            height: 40px; /* Tinggi tombol mulai */
            font-size: 16px; /* Ukuran font untuk teks tombol mulai */
            cursor: pointer; /* Mengubah kursor saat hover */
            background-color: #007bff; /* Warna latar belakang tombol mulai */
            color: white; /* Warna teks tombol mulai */
            border: none; /* Menghilangkan border default */
            border-radius: 5px; /* Membuat sudut tombol mulai melengkung */
            text-align: center; /* Mengatur teks agar terpusat */
        }

        #btn-start:active {
            background-color: #0056b3; /* Warna tombol mulai saat ditekan */
        }

        input[type="text"] {
            padding: 12px 20px; /* Memberikan padding pada input teks */
            font-size: 16px; /* Ukuran font untuk input teks */
            border: 2px solid #ddd; /* Border untuk input teks */
            border-radius: 8px; /* Membuat sudut input teks melengkung */
            box-sizing: border-box; /* Menghitung padding dan border dalam lebar dan tinggi */
            text-align: center; /* Mengatur teks agar terpusat */
            width: auto; /* Lebar otomatis */
            min-width: 150px; /* Lebar minimum 150px */
            max-width: 100%; /* Lebar maksimum 100% dari container */
            transition: all 0.3s ease; /* Transisi untuk perubahan gaya */
        }

        input[type="text"]:focus {
            border-color: #5d9bfb; /* Mengubah warna border saat fokus */
            box-shadow: 0 0 8px rgba(93, 155, 251, 0.5); /* Menambahkan bayangan saat fokus */
            outline: none; /* Menghilangkan outline saat fokus */
        }

        input[type="text"]::placeholder {
            color: #aaa; /* Warna placeholder */
            font-style: italic; /* Mengatur gaya font placeholder menjadi miring */
            text-align: center; /* Mengatur teks placeholder agar terpusat */
        }

        .error-message {
            color: #000000; /* Warna teks untuk pesan kesalahan */
            font-size: 14px; /* Ukuran font untuk pesan kesalahan */
            margin-top: 5px; /* Margin atas untuk pesan kesalahan */
            text-align: center; /* Mengatur teks agar terpusat */
        }
    </style>
</head>

<body>
    <!-- Container untuk input IP dan tombol mulai -->
    <div id="start" class="start-container">
        <span id="error-message" class="error-message"></span> <!-- Tempat untuk menampilkan pesan kesalahan -->
        <input type="text" id="textInput" placeholder="IP Address dan port"> <!-- Input untuk alamat IP dan port -->
        <button id="btn-start" type="button" onclick="connect()">Mulai</button> <!-- Tombol untuk memulai koneksi -->
    </div>

    <!-- Container utama yang tersembunyi sampai koneksi berhasil -->
    <div id="main" class="main-container hidden">
        <div class="column">
            <button class="button" id="btn-left-up">Atas</button> <!-- Tombol untuk gerakan atas kiri -->
            <button class="button" id="btn-left-down">Bawah</button> <!-- Tombol untuk gerakan bawah kiri -->
        </div>
        <div class="seekbar-container">
            <input type="range" min="0" max="255" value="180" id="seekbar" class="seekbar"> <!-- Seekbar untuk mengatur kecepatan -->
            <label id="seekbar-value">180</label> <!-- Label untuk menampilkan nilai seekbar -->
        </div>
        <div class="column">
            <button class="button" id="btn-right-up">Atas</button> <!-- Tombol untuk gerakan atas kanan -->
            <button class="button" id="btn-right-down">bawah</button> <!-- Tombol untuk gerakan bawah kanan -->
        </div>
    </div>

    <script>
        let ws; // Variabel untuk menyimpan koneksi WebSocket

        // Fungsi untuk menghubungkan WebSocket
        function connect() {
            var input = document.getElementById('textInput'); // Mengambil elemen input teks
            var errorMessage = document.getElementById('error-message'); // Mengambil elemen pesan kesalahan

            // Validasi input IP
            if (input.value.trim() === '') {
                errorMessage.textContent = "IP tidak boleh kosong!"; // Menampilkan pesan kesalahan
                errorMessage.style.color = "#e74c3c"; // Mengubah warna pesan kesalahan
                return; // Menghentikan eksekusi jika IP kosong
            }

            // Memeriksa apakah WebSocket didukung
            if (window.WebSocket) {
                ws = new WebSocket("ws://" + input.value); // Membuat koneksi WebSocket

                errorMessage.textContent = "Menghubungkan..."; // Menampilkan status menghubungkan
                errorMessage.style.color = "#000000"; // Mengubah warna pesan status

                // Menangani koneksi berhasil
                ws.onopen = () => {
                    errorMessage.textContent = "Tersambung!"; // Menampilkan pesan berhasil terhubung
                    errorMessage.style.color = "#4ae73c"; // Mengubah warna pesan sukses
                    setTimeout(function () {
                        if (typeof ws != 'undefined') {
                            if (ws.readyState === WebSocket.OPEN) {
                                document.getElementById('main').classList.remove('hidden'); // Menampilkan container utama
                                document.getElementById('start').classList.add('hidden'); // Menyembunyikan container awal
                            }
                        }
                    }, 1000); // Menunggu 1 detik sebelum mengubah tampilan
                }

                // Menangani koneksi ditutup
                ws.onclose = () => {
                    errorMessage.textContent = "Gagal terkoneksi!"; // Menampilkan pesan gagal terhubung
                    errorMessage.style.color = "#e74c3c"; // Mengubah warna pesan kesalahan
                    ws = undefined; // Mengatur ws menjadi undefined
                }

                // Menangani kesalahan pada koneksi
                ws.onerror = (error) => {
                    errorMessage.textContent = "Error: " + error; // Menampilkan pesan kesalahan
                    errorMessage.style.color = "#e74c3c"; // Mengubah warna pesan kesalahan
                    ws = undefined; // Mengatur ws menjadi undefined
                }
            } else {
                errorMessage.textContent = "WebSockets tidak didukung, menggunakan fallback."; // Pesan jika WebSocket tidak didukung
                return; // Menghentikan eksekusi
            }
        }

        // Objek untuk menyimpan status tombol dan kecepatan
        const buttonState = {
            left: {
                up: false,
                down: false
            },
            right: {
                up: false,
                down: false
            },
            speed: 180, // Kecepatan awal
        };

        // Fungsi untuk mengirim status tombol melalui WebSocket
        function sendState() {
            const data = {
                data: buttonState // Mengemas status tombol dalam objek
            };
            if (typeof ws != 'undefined') {
                if (ws.readyState === WebSocket.OPEN) {
                    ws.send(JSON.stringify(data)); // Mengirim data sebagai string JSON
                } else {
                    // Jika WebSocket tidak terbuka, tampilkan container utama
                    document.getElementById('main').classList.remove('hidden');
                    document.getElementById('start').classList.add('hidden');
                }
            }
        }

        // Mengambil elemen seekbar dan label nilai
        const seekbar = document.getElementById("seekbar");
        const seekbarValue = document.getElementById("seekbar-value");

        // Menangani perubahan pada seekbar
        seekbar.addEventListener("input", () => {
            seekbarValue.textContent = seekbar.value; // Memperbarui label dengan nilai seekbar
            buttonState["speed"] = seekbar.value; // Mengatur kecepatan dalam objek status
            sendState(); // Mengirim status baru
        });

        // Mengambil tombol kontrol arah
        const btnLeftUp = document.getElementById("btn-left-up");
        const btnLeftDown = document.getElementById("btn-left-down");
        const btnRightUp = document.getElementById("btn-right-up");
        const btnRightDown = document.getElementById("btn-right-down");

        // Fungsi untuk menangani saat tombol ditekan
        function handlePress(button, name, stateKey, direction) {
            button.classList.add("active"); // Menambahkan kelas aktif pada tombol
            buttonState[stateKey][direction] = true; // Mengatur status tombol menjadi ditekan
            console.log(`${name} pressed`); // Menampilkan log di konsol
            sendState(); // Mengirim status baru
        }

        // Fungsi untuk menangani saat tombol dilepaskan
        function handleRelease(button, name, stateKey, direction) {
            button.classList.remove("active"); // Menghapus kelas aktif dari tombol
            buttonState[stateKey][direction] = false; // Mengatur status tombol menjadi tidak ditekan
            console.log(`${name} released`); // Menampilkan log di konsol
            sendState(); // Mengirim status baru
        }

        // Menambahkan event listener untuk tombol kiri atas
        btnLeftUp.addEventListener("touchstart", () => handlePress(btnLeftUp, "Left Up", "left", "up"), {
            passive: true
        });
        btnLeftUp.addEventListener("touchend", () => handleRelease(btnLeftUp, "Left Up", "left", "up"), {
            passive: true
        });
        btnLeftUp.addEventListener("touchcancel", () => handleRelease(btnLeftUp, "Left Up", "left", "up"), {
            passive: true
        });

        // Menambahkan event listener untuk tombol kiri bawah
        btnLeftDown.addEventListener("touchstart", () => handlePress(btnLeftDown, "Left Down", "left", "down"), {
            passive: true
        });
        btnLeftDown.addEventListener("touchend", () => handleRelease(btnLeftDown, "Left Down", "left", "down"), {
            passive: true
        });
        btnLeftDown.addEventListener("touchcancel", () => handleRelease(btnLeftDown, "Left Down", "left", "down"), {
            passive: true
        });

        // Menambahkan event listener untuk tombol kanan atas
        btnRightUp.addEventListener("touchstart", () => handlePress(btnRightUp, "Right Up", "right", "up"), {
            passive: true
        });
        btnRightUp.addEventListener("touchend", () => handleRelease(btnRightUp, "Right Up", "right", "up"), {
            passive: true
        });
        btnRightUp.addEventListener("touchcancel", () => handleRelease(btnRightUp, "Right Up", "right", "up"), {
            passive: true
        });

        // Menambahkan event listener untuk tombol kanan bawah
        btnRightDown.addEventListener("touchstart", () => handlePress(btnRightDown, "Right Down", "right", "down"), {
            passive: true
        });
        btnRightDown.addEventListener("touchend", () => handleRelease(btnRightDown, "Right Down", "right", "down"), {
            passive: true
        });
        btnRightDown.addEventListener("touchcancel", () => handleRelease(btnRightDown, "Right Down", "right", "down"), {
            passive: true
        });

        // Menangani penutupan jendela
        window.addEventListener('beforeunload', function (event) {
            if (typeof ws != 'undefined') {
                if (ws.readyState === WebSocket.OPEN) {
                    ws.close(); // Menutup koneksi WebSocket saat jendela ditutup
                }
            }
        });

    </script>
</body>

</html>